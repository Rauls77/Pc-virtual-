name: Configurar PC Virtual com Parsec

on:
  workflow_dispatch:

jobs:
  setup:
    runs-on: ubuntu-latest
    steps:
      # Etapa 1: Configurar o AWS CLI
      - name: Install AWS CLI
        run: |
          sudo apt-get update
          sudo apt-get install awscli -y
          aws --version

      # Etapa 2: Configurar AWS CLI com credenciais (substitua com suas credenciais no GitHub Secrets)
      - name: Configure AWS CLI with credentials
        run: |
          aws configure set aws_access_key_id ${{ secrets.AWS_ACCESS_KEY_ID }}
          aws configure set aws_secret_access_key ${{ secrets.AWS_SECRET_ACCESS_KEY }}
          aws configure set default.region us-east-1  # Altere para sua região

      # Etapa 3: Criar Instância EC2 na AWS com GPU
      - name: Create EC2 instance with GPU
        run: |
          aws ec2 run-instances \
            --image-id ami-0abcdef1234567890 \  # Substitua com a AMI correta
            --count 1 \
            --instance-type p3.2xlarge \  # Instância com GPU, como Tesla K80 ou equivalente
            --key-name my-key-pair \  # Substitua com sua chave privada
            --security-group-ids sg-0123456789abcdef0 \  # Substitua com o ID do seu grupo de segurança
            --subnet-id subnet-12345678 \  # Substitua com o ID da sua subnet
            --tag-specifications 'ResourceType=instance,Tags=[{Key=Name,Value=ParsecVM}]'

      # Etapa 4: Conectar à instância EC2 e instalar Parsec
      - name: Install Parsec on EC2 instance
        run: |
          ssh -i "my-key-pair.pem" ubuntu@ec2-XX-XX-XX-XX.compute-1.amazonaws.com <<EOF
            # Baixar e instalar o Parsec
            wget https://builds.parsec.app/package/parsec-installer.exe -O parsec-installer.exe
            wine parsec-installer.exe  # Instalar o Parsec usando Wine no Ubuntu
            # Configurar Parsec automaticamente (exemplo)
            # Adicione qualquer configuração adicional que você precise para Parsec aqui
          EOF

      # Etapa 5: Gerar Link de Conexão para Parsec
      - name: Generate Parsec connection link
        run: |
          echo "Link de conexão Parsec gerado com sucesso! Agora, você pode se conectar ao PC virtual com Parsec."

      # Etapa 6: Commit e Push Automático (se necessário)
      - name: Commit and Push Changes
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          git config --global user.name "github-actions[bot]"
          git config --global user.email "github-actions[bot]@users.noreply.github.com"
          git add .
          git commit -m "Automated setup for Parsec PC Virtual"
          git push

      # Etapa 7: Simular Execução Contínua (opcional)
      - name: Simulate Infinite Execution
        run: |
          while ($true) {
            Write-Host "Workflow em execução contínua às $(Get-Date)"
            Start-Sleep -Seconds 3600  # Pausa por 1 hora
          }
