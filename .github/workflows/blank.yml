name: Maximizar Recursos do GitHub Actions

on:
  workflow_dispatch:

jobs:
  optimize-system:
    name: Maximizar Armazenamento, RAM e Corrigir √Åudio/Mic
    runs-on: windows-latest

    steps:
      - name: üîç Verificar espa√ßo inicial
        run: Get-PSDrive C

      - name: üóëÔ∏è Liberar espa√ßo removendo pacotes desnecess√°rios
        run: |
          Remove-Item -Recurse -Force "C:\Program Files\dotnet"
          Remove-Item -Recurse -Force "C:\Program Files (x86)\Microsoft SDKs"
          Remove-Item -Recurse -Force "C:\Program Files (x86)\Windows Kits"
          Remove-Item -Recurse -Force "C:\ProgramData\chocolatey"
          Remove-Item -Recurse -Force "C:\Users\runneradmin\AppData\Local\Temp"
          Write-Host "‚úî Espa√ßo liberado!"

      - name: üíæ Expandir espa√ßo do disco
        run: |
          echo select volume c > diskpart-script.txt
          echo extend >> diskpart-script.txt
          echo exit >> diskpart-script.txt
          diskpart /s diskpart-script.txt
          wmic logicaldisk where "DeviceID='C:'" get Size,FreeSpace
        shell: powershell

      - name: üí° Maximizar Mem√≥ria RAM
        run: |
          Write-Host "Aumentando a mem√≥ria virtual..."
          wmic computersystem where name="%computername%" set AutomaticManagedPagefile=False
          wmic pagefileset where name="C:\\pagefile.sys" set InitialSize=16384,MaximumSize=32768
          Write-Host "‚úî Mem√≥ria virtual ajustada para 16GB-32GB"

      - name: üîä Corrigir √Åudio e Microfone
        run: |
          Write-Host "Ativando servi√ßos de √°udio..."
          Start-Service -Name "AudioSrv"
          Start-Service -Name "Audiosrv"
          Start-Service -Name "WindowsAudioEndpointBuilder"
          Write-Host "‚úî √Åudio ativado!"
          
          Write-Host "Ativando microfone..."
          reg add "HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\MMDevices\Audio\Capture" /v Microphone /t REG_DWORD /d 1 /f
          Write-Host "‚úî Microfone ativado!"

      - name: üîÑ Manter workflow rodando (7 dias)
        run: Start-Sleep -Seconds 604800
